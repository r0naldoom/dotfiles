#global sessions
bind-key "S" run-shell "sesh connect \"$(
  sesh list --icons --hide-duplicates | fzf-tmux -p 100%,100% --no-border \
    --ansi \
    --list-border \
    --no-sort --prompt '‚ö°  ' \
    --color 'list-border:15,input-border:15,preview-border:4,header-bg:7,header-border:7' \
    --input-border \
    --header-border \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-b:abort' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ÓØà  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-r:execute(tmux command-prompt -I {2} -p \"Rename {2}:\" \"rename-session -t {2} %%%%\")+reload(sesh list --icons)' \
    --preview 'sesh preview {}'
    --preview-window 'right:70%' \
    --preview 'sesh preview {}'
)\""

# root sessions
bind-key "R" run-shell "sesh connect \"\$(
  sesh list --icons | fzf-tmux -p 100%,100% --no-border \
    --query \"\$(sesh root)\" \
    --ansi \
    --list-border \
    --no-sort --prompt '‚ö°  ' \
    --color 'list-border:6,input-border:3,preview-border:4,header-bg:-1,header-border:6' \
    --input-border \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-b:abort' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind \"ctrl-r:execute(tmux command-prompt -I {2} -p 'Rename {2}:' 'rename-session -t {2} %%%%')+reload(sesh list --icons)\" \
    --preview-window 'right:70%' \
    --preview 'sesh preview {}'
)\""




### Prefixo e B√°sicos
set -g default-terminal "xterm-ghostty"
unbind C-a
set -g prefix C-Space
bind C-Space send-prefix
set -g mouse on
set -g history-limit 100000
set -g mode-keys vi
set -g status-keys vi
set -as terminal-overrides ',xterm-256color:Tc'
set -g base-index 1
setw -g pane-base-index 1
set-option -g renumber-windows on
set-option -g set-titles on
set-option -g set-titles-string "#S / #W"

set-option -g status-interval 1
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

### Navega√ß√£o entre panes com Ctrl + h/j/k/l
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

### Copy mode (v para entrar, como vim)
bind v copy-mode
bind-key -T copy-mode-vi 'Escape' send -X cancel
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection
# gh/gl para in√≠cio/fim da linha em copy mode
bind-key -T copy-mode-vi 'g' switch-client -T copy-mode-extended
bind-key -T copy-mode-extended 'h' send -X start-of-line \; switch-client -T copy-mode-vi
bind-key -T copy-mode-extended 'l' send -X end-of-line \; switch-client -T copy-mode-vi

### Navega√ß√£o de sess√µes
# Alternar entre √∫ltimas 2 sess√µes (como cd -)
bind Space switch-client -l
# Lista sess√µes ordenadas por tempo
bind s choose-tree -Zs -O time
# Deletar sess√£o no choose-tree com 'd'
bind -n d if -F '#{==:#{pane_mode},tree-mode}' 'send x' 'send d'

### Janelas r√°pidas (prefix + u/i/o/p)
bind u select-window -t 1
bind i select-window -t 2
bind o select-window -t 3
bind p select-window -t 4
# Janela anterior
bind m previous-window

### Layouts
bind e select-layout even-horizontal
bind E select-layout even-vertical
bind w select-layout main-horizontal
bind W select-layout main-vertical

### Zoom pane (toggle fullscreen)
bind M resize-pane -Z

### Sync panes (envia input para todos os panes)
bind Q setw synchronize-panes

### N√£o desconecta ao fechar √∫ltima janela
set -g detach-on-destroy off

### Reload da config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

### TPM (Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding
run-shell '[ -f ~/.tmux/plugins/tpm/tpm ] && ~/.tmux/plugins/tpm/tpm || true'

# === Paleta (Noctalia) ===
source-file ~/.config/tmux/noctalia-colors.conf

# === Separadores ===
set -g @SEP_RIGHT "ÓÇº"
set -g @SEP_LEFT  "ÓÇ∫"

# === Status bar geral ===
set-option -g status-position top
set-option -g status-justify centre
set -g status-style bg=terminal
set-option -g status-left-length 150
set-option -g status-right-length 150

# === Status esquerdo ===
set -g status-left "\
#[fg=#{@status_bg},bg=default]#{@SEP_LEFT}\
#[bg=#{@status_bg},fg=#{@status_fg},bold] #H | #S \
#[fg=#{@status_bg},bg=#{@status_secondary_bg}]#{@SEP_RIGHT}\
#[fg=#{@status_secondary_fg},bg=#{@status_secondary_bg}] üêß \
#[fg=#{@status_secondary_bg},bg=default]#{@SEP_RIGHT}\
"

# === Status direito ===
set -g status-right "\
#[fg=#{@status_secondary_bg},bg=default]#{@SEP_LEFT}\
#[bg=#{@status_secondary_bg},fg=#{@status_secondary_fg}] %d %B \
#[fg=#{@status_secondary_bg},bg=#{@status_bg}]#{@SEP_RIGHT}\
#[fg=#{@status_fg},bg=#{@status_bg},bold] %H:%M \
#[fg=#{@status_bg},bg=default]#{@SEP_RIGHT}\
"

# === Window list: inactive windows ===
set -g window-status-format "\
#[fg=#{@tab_inactive_num_bg},bg=default]#{@SEP_LEFT}\
#[bg=#{@tab_inactive_num_bg},fg=#{@tab_inactive_num_fg}] #I \
#[fg=#{@tab_inactive_num_bg},bg=#{@tab_inactive_name_bg}]#{@SEP_RIGHT}\
#[fg=#{@tab_inactive_name_fg},bg=#{@tab_inactive_name_bg}] #W \
#[fg=#{@tab_inactive_name_bg},bg=default]#{@SEP_RIGHT}\
"

# === Janela ativa ===
set -g window-status-current-format "\
#[fg=#{@tab_active_num_bg},bg=default]#{@SEP_LEFT}\
#[bg=#{@tab_active_num_bg},fg=#{@tab_active_num_fg},bold] #I \
#[fg=#{@tab_active_num_bg},bg=#{@tab_active_name_bg}]#{@SEP_RIGHT}\
#[fg=#{@tab_active_name_fg},bg=#{@tab_active_name_bg}] #W \
#[fg=#{@tab_active_name_bg},bg=default]#{@SEP_RIGHT}\
"

# === Ajustes finais ===
set-option -g message-style "fg=#{@message_fg},bg=#{@message_bg}"
set-option -g message-command-style "fg=#{@message_fg},bg=#{@message_bg}"
setw -g window-status-separator ""
